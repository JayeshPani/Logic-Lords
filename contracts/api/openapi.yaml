openapi: 3.1.0
info:
  title: InfraGuard API
  version: 1.0.0
  description: Contract-first API for infrastructure monitoring, risk analytics, and blockchain verification.
servers:
  - url: http://localhost:8080
    description: Local development
security:
  - BearerAuth: []
tags:
  - name: System
  - name: Assets
  - name: Telemetry
  - name: Risk
  - name: Forecast
  - name: Verification
  - name: Automation
paths:
  /health:
    get:
      tags: [System]
      operationId: getHealth
      summary: Service health check
      description: Returns API health and downstream dependency status.
      security: []
      responses:
        '200':
          description: API is healthy or degraded but reachable.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheckResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /assets:
    get:
      tags: [Assets]
      operationId: listAssets
      summary: List monitored assets
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - $ref: '#/components/parameters/ZoneParam'
        - $ref: '#/components/parameters/AssetTypeParam'
        - $ref: '#/components/parameters/AssetStatusParam'
      responses:
        '200':
          description: Paginated asset list.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags: [Assets]
      operationId: createAsset
      summary: Register a new infrastructure asset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAssetRequest'
      responses:
        '201':
          description: Asset created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /assets/{asset_id}:
    get:
      tags: [Assets]
      operationId: getAssetById
      summary: Get one asset
      parameters:
        - $ref: '#/components/parameters/AssetIdParam'
      responses:
        '200':
          description: Asset details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /assets/{asset_id}/health:
    get:
      tags: [Risk]
      operationId: getAssetHealth
      summary: Latest health score for an asset
      parameters:
        - $ref: '#/components/parameters/AssetIdParam'
      responses:
        '200':
          description: Latest health snapshot.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetHealthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /assets/{asset_id}/forecast:
    get:
      tags: [Forecast]
      operationId: getAssetFailureForecast
      summary: Failure forecast for an asset
      parameters:
        - $ref: '#/components/parameters/AssetIdParam'
        - $ref: '#/components/parameters/HorizonHoursParam'
      responses:
        '200':
          description: Forecast snapshot.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetForecastResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /telemetry/{asset_id}/latest:
    get:
      tags: [Telemetry]
      operationId: getAssetLatestTelemetry
      summary: Latest live telemetry for an asset
      description: Returns latest DHT11 + accelerometer-derived metrics from sensor-ingestion service.
      parameters:
        - $ref: '#/components/parameters/AssetIdParam'
      responses:
        '200':
          description: Latest telemetry snapshot.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetTelemetryResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /maintenance/{maintenance_id}/verification:
    get:
      tags: [Verification]
      operationId: getMaintenanceVerification
      summary: Blockchain verification details for maintenance
      parameters:
        - $ref: '#/components/parameters/MaintenanceIdParam'
      responses:
        '200':
          description: Verification record.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceVerificationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /maintenance/{maintenance_id}/verification/track:
    post:
      tags: [Verification]
      operationId: trackMaintenanceVerification
      summary: Trigger confirmation tracking for maintenance verification
      parameters:
        - $ref: '#/components/parameters/MaintenanceIdParam'
      responses:
        '200':
          description: Verification tracking result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceVerificationTrackResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /maintenance/{maintenance_id}/evidence/uploads:
    post:
      tags: [Verification]
      operationId: createEvidenceUpload
      summary: Create signed upload session for maintenance evidence
      parameters:
        - $ref: '#/components/parameters/MaintenanceIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEvidenceUploadRequest'
      responses:
        '200':
          description: Upload session and initial evidence record.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateEvidenceUploadResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /maintenance/{maintenance_id}/evidence/{evidence_id}/finalize:
    post:
      tags: [Verification]
      operationId: finalizeEvidenceUpload
      summary: Finalize uploaded evidence and compute SHA-256 hash
      parameters:
        - $ref: '#/components/parameters/MaintenanceIdParam'
        - $ref: '#/components/parameters/EvidenceIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FinalizeEvidenceUploadRequest'
      responses:
        '200':
          description: Finalized evidence record.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FinalizeEvidenceUploadResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /maintenance/{maintenance_id}/evidence:
    get:
      tags: [Verification]
      operationId: listMaintenanceEvidence
      summary: List evidence records for a maintenance action
      parameters:
        - $ref: '#/components/parameters/MaintenanceIdParam'
      responses:
        '200':
          description: Evidence list.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvidenceListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /maintenance/{maintenance_id}/verification/submit:
    post:
      tags: [Verification]
      operationId: submitMaintenanceVerification
      summary: Submit blockchain verification after evidence upload
      parameters:
        - $ref: '#/components/parameters/MaintenanceIdParam'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerificationSubmitRequest'
      responses:
        '200':
          description: Verification submission result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerificationSubmitResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /blockchain/connect:
    post:
      tags: [Verification]
      operationId: connectBlockchainSepolia
      summary: Validate live Sepolia connectivity
      description: Proxies blockchain-verification service Sepolia RPC checks for dashboard action.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
      responses:
        '200':
          description: Sepolia connectivity status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BlockchainConnectResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /automation/incidents:
    get:
      tags: [Automation]
      operationId: listAutomationIncidents
      summary: List active automation incidents
      responses:
        '200':
          description: Incident list from orchestration service.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutomationIncidentListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /automation/incidents/{workflow_id}:
    get:
      tags: [Automation]
      operationId: getAutomationIncident
      summary: Get one automation incident
      parameters:
        - $ref: '#/components/parameters/WorkflowIdParam'
      responses:
        '200':
          description: Incident details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutomationIncidentResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /automation/incidents/{workflow_id}/acknowledge:
    post:
      tags: [Automation]
      operationId: acknowledgeAutomationIncident
      summary: Acknowledge an automation incident
      parameters:
        - $ref: '#/components/parameters/WorkflowIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutomationAcknowledgeRequest'
      responses:
        '200':
          description: Acknowledgement recorded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutomationAcknowledgeResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    AssetIdParam:
      name: asset_id
      in: path
      required: true
      schema:
        type: string
        minLength: 1
        example: asset_w12_bridge_0042
    MaintenanceIdParam:
      name: maintenance_id
      in: path
      required: true
      schema:
        type: string
        pattern: '^mnt_[0-9]{8}_[0-9]+$'
        example: mnt_20260213_0012
    EvidenceIdParam:
      name: evidence_id
      in: path
      required: true
      schema:
        type: string
        minLength: 1
        example: evd_20260215_0001
    WorkflowIdParam:
      name: workflow_id
      in: path
      required: true
      schema:
        type: string
        minLength: 1
        example: wf_20260214_120001_0001
    PageParam:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
    PageSizeParam:
      name: page_size
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 200
        default: 20
    ZoneParam:
      name: zone
      in: query
      required: false
      schema:
        type: string
        minLength: 1
        maxLength: 64
    AssetTypeParam:
      name: asset_type
      in: query
      required: false
      schema:
        $ref: '#/components/schemas/AssetType'
    AssetStatusParam:
      name: status
      in: query
      required: false
      schema:
        $ref: '#/components/schemas/AssetStatus'
    HorizonHoursParam:
      name: horizon_hours
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 168
        default: 72

  responses:
    BadRequest:
      description: Invalid request payload or parameters.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: BAD_REQUEST
              message: Invalid input.
              trace_id: trc_7bca1ac3
    Unauthorized:
      description: Authentication required or token invalid.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: UNAUTHORIZED
              message: Missing or invalid authentication token.
              trace_id: trc_7bca1ac3
    Forbidden:
      description: Caller is authenticated but lacks required permissions.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: FORBIDDEN
              message: Access denied.
              trace_id: trc_7bca1ac3
    NotFound:
      description: Requested entity was not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: NOT_FOUND
              message: Resource not found.
              trace_id: trc_7bca1ac3
    Conflict:
      description: Resource conflict (for example duplicate identifier).
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: CONFLICT
              message: Asset already exists.
              trace_id: trc_7bca1ac3
    UnprocessableEntity:
      description: Semantic validation failed.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: UNPROCESSABLE_ENTITY
              message: Validation failed.
              trace_id: trc_7bca1ac3
    InternalServerError:
      description: Unexpected server failure.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: INTERNAL_SERVER_ERROR
              message: Unexpected error.
              trace_id: trc_7bca1ac3

  schemas:
    ApiMeta:
      type: object
      required: [request_id, timestamp]
      properties:
        request_id:
          type: string
          minLength: 8
          maxLength: 128
          example: req_01JCSB5Y0M5EC5PM03B59XK3P3
        timestamp:
          type: string
          format: date-time

    ErrorDetail:
      type: object
      required: [field, issue]
      properties:
        field:
          type: string
        issue:
          type: string

    ErrorBody:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
        message:
          type: string
        trace_id:
          type: string
        details:
          type: array
          items:
            $ref: '#/components/schemas/ErrorDetail'

    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          $ref: '#/components/schemas/ErrorBody'

    DependencyHealth:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [ok, degraded, down]
        latency_ms:
          type: integer
          minimum: 0

    HealthCheckResponse:
      type: object
      required: [status, service, version, timestamp]
      properties:
        status:
          type: string
          enum: [ok, degraded]
        service:
          type: string
          example: api-gateway
        version:
          type: string
          example: 1.0.0
        timestamp:
          type: string
          format: date-time
        dependencies:
          type: object
          properties:
            database:
              $ref: '#/components/schemas/DependencyHealth'
            event_stream:
              $ref: '#/components/schemas/DependencyHealth'
            blockchain_verifier:
              $ref: '#/components/schemas/DependencyHealth'

    AssetType:
      type: string
      enum: [bridge, road, tunnel, flyover, other]

    AssetStatus:
      type: string
      enum: [active, maintenance, retired]

    Severity:
      type: string
      enum: [healthy, watch, warning, critical]

    RiskLevel:
      type: string
      enum: [Very Low, Low, Moderate, High, Critical]

    GeoPoint:
      type: object
      required: [lat, lon]
      properties:
        lat:
          type: number
          minimum: -90
          maximum: 90
        lon:
          type: number
          minimum: -180
          maximum: 180

    Asset:
      type: object
      required:
        - asset_id
        - name
        - asset_type
        - status
        - zone
        - location
        - created_at
        - updated_at
      properties:
        asset_id:
          type: string
          pattern: '^asset_[a-z0-9]+_[a-z0-9]+_[0-9]+$'
        name:
          type: string
          minLength: 2
          maxLength: 120
        asset_type:
          $ref: '#/components/schemas/AssetType'
        status:
          $ref: '#/components/schemas/AssetStatus'
        zone:
          type: string
          minLength: 1
          maxLength: 64
        location:
          $ref: '#/components/schemas/GeoPoint'
        metadata:
          type: object
          additionalProperties: true
        installed_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateAssetRequest:
      type: object
      required: [asset_id, name, asset_type, zone, location]
      properties:
        asset_id:
          type: string
          pattern: '^asset_[a-z0-9]+_[a-z0-9]+_[0-9]+$'
        name:
          type: string
          minLength: 2
          maxLength: 120
        asset_type:
          $ref: '#/components/schemas/AssetType'
        zone:
          type: string
          minLength: 1
          maxLength: 64
        location:
          $ref: '#/components/schemas/GeoPoint'
        metadata:
          type: object
          additionalProperties: true
        installed_at:
          type: string
          format: date-time
      additionalProperties: false

    Pagination:
      type: object
      required: [page, page_size, total_items, total_pages]
      properties:
        page:
          type: integer
          minimum: 1
        page_size:
          type: integer
          minimum: 1
        total_items:
          type: integer
          minimum: 0
        total_pages:
          type: integer
          minimum: 0

    AssetResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/Asset'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    AssetListResponse:
      type: object
      required: [data, pagination, meta]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Asset'
        pagination:
          $ref: '#/components/schemas/Pagination'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    RiskComponents:
      type: object
      required: [mechanical_stress, thermal_stress, fatigue, environmental_exposure]
      properties:
        mechanical_stress:
          type: number
          minimum: 0
          maximum: 1
        thermal_stress:
          type: number
          minimum: 0
          maximum: 1
        fatigue:
          type: number
          minimum: 0
          maximum: 1
        environmental_exposure:
          type: number
          minimum: 0
          maximum: 1

    AssetHealth:
      type: object
      required: [asset_id, evaluated_at, health_score, risk_level, failure_probability_72h, anomaly_flag]
      properties:
        asset_id:
          type: string
        evaluated_at:
          type: string
          format: date-time
        health_score:
          type: number
          minimum: 0
          maximum: 1
        risk_level:
          $ref: '#/components/schemas/RiskLevel'
        failure_probability_72h:
          type: number
          minimum: 0
          maximum: 1
        anomaly_flag:
          type: integer
          enum: [0, 1]
        severity:
          $ref: '#/components/schemas/Severity'
        components:
          $ref: '#/components/schemas/RiskComponents'
        model_versions:
          type: object
          properties:
            fuzzy:
              type: string
              example: v1
            fusion:
              type: string
              example: v1

    AssetHealthResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/AssetHealth'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    AssetForecast:
      type: object
      required:
        - asset_id
        - generated_at
        - horizon_hours
        - failure_probability_72h
        - confidence
      properties:
        asset_id:
          type: string
        generated_at:
          type: string
          format: date-time
        horizon_hours:
          type: integer
          minimum: 1
          maximum: 168
        failure_probability_72h:
          type: number
          minimum: 0
          maximum: 1
        confidence:
          type: number
          minimum: 0
          maximum: 1
        model:
          type: object
          properties:
            name:
              type: string
              example: lstm_failure_forecast
            version:
              type: string
              example: v1

    AssetForecastResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/AssetForecast'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    VerificationStatus:
      type: string
      enum: [pending, submitted, confirmed, failed]

    WorkflowVerificationStatus:
      type: string
      enum: [awaiting_evidence, pending, submitted, confirmed, failed]

    EvidenceStatus:
      type: string
      enum: [upload_pending, finalized, deleted]

    EvidenceItem:
      type: object
      required:
        - evidence_id
        - maintenance_id
        - asset_id
        - filename
        - content_type
        - size_bytes
        - storage_uri
        - uploaded_by
        - uploaded_at
        - status
      properties:
        evidence_id:
          type: string
          minLength: 1
        maintenance_id:
          type: string
          pattern: '^mnt_[0-9]{8}_[0-9]+$'
        asset_id:
          type: string
        filename:
          type: string
          minLength: 1
          maxLength: 240
        content_type:
          type: string
          minLength: 1
          maxLength: 120
        size_bytes:
          type: integer
          minimum: 1
        storage_uri:
          type: string
          minLength: 1
        sha256_hex:
          type: string
          pattern: '^[a-fA-F0-9]{64}$'
          nullable: true
        uploaded_by:
          type: string
          minLength: 1
          maxLength: 128
        uploaded_at:
          type: string
          format: date-time
        finalized_at:
          type: string
          format: date-time
          nullable: true
        status:
          $ref: '#/components/schemas/EvidenceStatus'
        category:
          type: string
          maxLength: 64
          nullable: true
        notes:
          type: string
          maxLength: 2000
          nullable: true

    CreateEvidenceUploadRequest:
      type: object
      required: [asset_id, filename, content_type, size_bytes]
      properties:
        asset_id:
          type: string
        filename:
          type: string
          minLength: 1
          maxLength: 240
        content_type:
          type: string
          minLength: 1
          maxLength: 120
        size_bytes:
          type: integer
          minimum: 1
        category:
          type: string
          maxLength: 64
        notes:
          type: string
          maxLength: 2000
      additionalProperties: false

    CreateEvidenceUploadResponse:
      type: object
      required: [data, upload_url, upload_method, upload_headers, expires_at, meta]
      properties:
        data:
          $ref: '#/components/schemas/EvidenceItem'
        upload_url:
          type: string
        upload_method:
          type: string
          enum: [PUT]
        upload_headers:
          type: object
          additionalProperties:
            type: string
        expires_at:
          type: string
          format: date-time
        meta:
          $ref: '#/components/schemas/ApiMeta'

    FinalizeEvidenceUploadRequest:
      type: object
      required: [uploaded_by]
      properties:
        uploaded_by:
          type: string
          minLength: 1
          maxLength: 128
      additionalProperties: false

    FinalizeEvidenceUploadResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/EvidenceItem'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    EvidenceListResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/EvidenceItem'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    VerificationSubmitRequest:
      type: object
      properties:
        operator_wallet_address:
          type: string
          pattern: '^0x[a-fA-F0-9]{40}$'
        submitted_by:
          type: string
          minLength: 1
          maxLength: 128
      additionalProperties: false

    VerificationSubmitResult:
      type: object
      required: [workflow_id, maintenance_id, verification_status]
      properties:
        workflow_id:
          type: string
        maintenance_id:
          type: string
          pattern: '^mnt_[0-9]{8}_[0-9]+$'
        verification_status:
          $ref: '#/components/schemas/WorkflowVerificationStatus'
        verification_maintenance_id:
          type: string
          nullable: true
        verification_tx_hash:
          type: string
          pattern: '^0x[a-fA-F0-9]{64}$'
          nullable: true
        verification_error:
          type: string
          nullable: true
        verification_updated_at:
          type: string
          format: date-time
          nullable: true

    VerificationSubmitResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/VerificationSubmitResult'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    MaintenanceVerification:
      type: object
      required:
        - maintenance_id
        - asset_id
        - verification_status
        - evidence_hash
        - network
        - contract_address
      properties:
        verification_id:
          type: string
        command_id:
          type: string
          format: uuid
        maintenance_id:
          type: string
          pattern: '^mnt_[0-9]{8}_[0-9]+$'
        asset_id:
          type: string
        verification_status:
          $ref: '#/components/schemas/VerificationStatus'
        evidence_hash:
          type: string
          pattern: '^0x[a-fA-F0-9]{64}$'
        tx_hash:
          type: string
          pattern: '^0x[a-fA-F0-9]{64}$'
        network:
          type: string
        contract_address:
          type: string
          pattern: '^0x[a-fA-F0-9]{40}$'
        chain_id:
          type: integer
          minimum: 1
        block_number:
          type: integer
          minimum: 0
        confirmations:
          type: integer
          minimum: 0
          default: 0
        required_confirmations:
          type: integer
          minimum: 1
          default: 1
        submitted_at:
          type: string
          format: date-time
        confirmed_at:
          type: string
          format: date-time
        failure_reason:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        trace_id:
          type: string
        verified_at:
          type: string
          format: date-time

    MaintenanceVerificationResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/MaintenanceVerification'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    MaintenanceVerificationTrackResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/MaintenanceVerification'
        maintenance_verified_event:
          type: object
          additionalProperties: true
          nullable: true
        meta:
          $ref: '#/components/schemas/ApiMeta'

    BlockchainConnectResponse:
      type: object
      required:
        - connected
        - network
        - expected_chain_id
        - checked_at
        - message
        - source
      properties:
        connected:
          type: boolean
        network:
          type: string
          enum: [sepolia]
        expected_chain_id:
          type: integer
          minimum: 1
          example: 11155111
        chain_id:
          type: integer
          minimum: 1
          nullable: true
        latest_block:
          type: integer
          minimum: 0
          nullable: true
        contract_address:
          type: string
          pattern: '^0x[a-fA-F0-9]{40}$'
          nullable: true
        contract_deployed:
          type: boolean
          nullable: true
        checked_at:
          type: string
          format: date-time
        message:
          type: string
        source:
          type: string
          example: services/blockchain-verification-service

    SensorCardMetric:
      type: object
      required: [value, unit, delta, samples]
      properties:
        value:
          type: number
        unit:
          type: string
        delta:
          type: string
        samples:
          type: array
          items:
            type: number

    TelemetryComputed:
      type: object
      required:
        - acceleration_magnitude_g
        - vibration_rms_ms2
        - tilt_deg
        - strain_proxy_microstrain
        - thermal_stress_index
        - fatigue_index
        - health_proxy_score
      properties:
        acceleration_magnitude_g:
          type: number
        vibration_rms_ms2:
          type: number
        tilt_deg:
          type: number
        strain_proxy_microstrain:
          type: number
        thermal_stress_index:
          type: number
          minimum: 0
          maximum: 1
        fatigue_index:
          type: number
          minimum: 0
          maximum: 1
        health_proxy_score:
          type: number
          minimum: 0
          maximum: 1

    AssetTelemetry:
      type: object
      required: [asset_id, source, captured_at, sensors, computed]
      properties:
        asset_id:
          type: string
        source:
          type: string
          example: firebase
        captured_at:
          type: string
          format: date-time
        sensors:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/SensorCardMetric'
        computed:
          $ref: '#/components/schemas/TelemetryComputed'

    AssetTelemetryResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/AssetTelemetry'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    PriorityLevel:
      type: string
      enum: [low, medium, high, critical]

    WorkflowStatus:
      type: string
      enum: [started, inspection_requested, maintenance_completed, failed]

    EscalationStage:
      type: string
      enum: [management_notified, acknowledged, police_notified, maintenance_completed]

    AutomationIncident:
      type: object
      required:
        - workflow_id
        - asset_id
        - risk_priority
        - escalation_stage
        - status
        - trigger_reason
        - created_at
        - updated_at
      properties:
        workflow_id:
          type: string
        asset_id:
          type: string
        risk_priority:
          $ref: '#/components/schemas/PriorityLevel'
        escalation_stage:
          $ref: '#/components/schemas/EscalationStage'
        status:
          $ref: '#/components/schemas/WorkflowStatus'
        trigger_reason:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        authority_notified_at:
          type: string
          format: date-time
          nullable: true
        authority_ack_deadline_at:
          type: string
          format: date-time
          nullable: true
        acknowledged_at:
          type: string
          format: date-time
          nullable: true
        acknowledged_by:
          type: string
          nullable: true
        ack_notes:
          type: string
          nullable: true
        police_notified_at:
          type: string
          format: date-time
          nullable: true
        management_dispatch_ids:
          type: array
          items:
            type: string
        police_dispatch_ids:
          type: array
          items:
            type: string
        inspection_ticket_id:
          type: string
          nullable: true
        maintenance_id:
          type: string
          nullable: true

    AutomationIncidentListResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/AutomationIncident'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    AutomationIncidentResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/AutomationIncident'
        meta:
          $ref: '#/components/schemas/ApiMeta'

    AutomationAcknowledgeRequest:
      type: object
      required: [acknowledged_by]
      properties:
        acknowledged_by:
          type: string
          minLength: 1
          maxLength: 128
        ack_notes:
          type: string
          maxLength: 2000
      additionalProperties: false

    AutomationAcknowledgeResult:
      type: object
      required: [workflow_id, escalation_stage, acknowledged_at, acknowledged_by]
      properties:
        workflow_id:
          type: string
        escalation_stage:
          $ref: '#/components/schemas/EscalationStage'
        acknowledged_at:
          type: string
          format: date-time
        acknowledged_by:
          type: string
        ack_notes:
          type: string
          nullable: true
        police_notified_at:
          type: string
          format: date-time
          nullable: true

    AutomationAcknowledgeResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          $ref: '#/components/schemas/AutomationAcknowledgeResult'
        meta:
          $ref: '#/components/schemas/ApiMeta'
